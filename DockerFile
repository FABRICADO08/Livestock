# Step 1: Build the application using Maven
FROM maven:3.8.4-openjdk-11 AS build
COPY . /app
WORKDIR /app
RUN mvn clean package

# Step 2: Run the application using Jetty Runner
FROM openjdk:11-jre-slim
WORKDIR /app
# Copy the WAR file and the jetty-runner from the build stage
COPY --from=build /app/target/*.war /app/livestock.war
# You need the jetty-runner.jar. If it's not in your target, we download it:
ADD https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-runner/9.4.44.v20210927/jetty-runner-9.4.44.v20210927.jar /app/jetty-runner.jar

# Expose the port Render provides
EXPOSE 8080

# Start the app
CMD ["java", "-jar", "jetty-runner.jar", "--port", "8080", "livestock.war"]