# Step 1: Build the application using Maven
FROM maven:3.8.4-openjdk-11 AS build
COPY . /app
WORKDIR /app
RUN mvn clean package -DskipTests

# Step 2: Run the application using Temurin (Official Replacement)
FROM eclipse-temurin:11-jre
WORKDIR /app

# Copy the WAR file from the build stage
COPY --from=build /app/target/*.war /app/livestock.war

# Download the jetty-runner to run the WAR file
ADD https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-runner/9.4.44.v20210927/jetty-runner-9.4.44.v20210927.jar /app/jetty-runner.jar

# Expose port 8080 for Render
EXPOSE 8080

# Start the application
CMD ["java", "-jar", "jetty-runner.jar", "--port", "10000", "livestock.war"]